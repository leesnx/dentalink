import{r as p,j as e,L as W,$ as x}from"./app-JcAsAuql.js";import{A as B,U as I,C as L,D as E}from"./app-layout-E1jTg9LY.js";import{a as f}from"./ApiAdmin-CigcBv4Z.js";import{R as v}from"./refresh-cw-BJG4YFjv.js";import{D as V}from"./download-BeDJjoQd.js";import{A as w}from"./arrow-up-right-u77aCWnL.js";import{A as _}from"./activity-BPAZzZpE.js";import{c as H}from"./button-f96-MP48.js";import{C as q}from"./calendar-plus-CgHhfb6t.js";import{C as Q}from"./circle-x-CZFefVG-.js";import"./index-CfwClSTy.js";import"./index-jL6B-qfF.js";import"./index-BwiEApH7.js";import"./index-Bm2cAylQ.js";import"./app-logo-icon-DBA5PkxD.js";import"./sweetalert2.esm.all-acGi8jXx.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],z=H("ArrowDownRight",X);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],T=H("UserPlus",G),J=[{title:"Dashboard",href:"/admin/dashboard"}];function he(){const[i,u]=p.useState({total_patients:0,total_staff:0,appointments_today:0,appointments_this_week:0,revenue_this_month:0,outstanding_balance:0,recent_registrations:0}),[y,A]=p.useState([]),[D,$]=p.useState([]),[h,k]=p.useState(!0),[R,S]=p.useState(!1),b=(t,a)=>{var r;return t?t[a]?t[a]:(r=t.data)!=null&&r[a]?t.data[a]:t.data||t:null},j=async()=>{try{k(!0);let t;try{t=await f.getDashboardData()}catch(s){console.warn("Dashboard API failed, fetching individual components:",s),t=await P()}console.log("Dashboard response:",t);const a=b(t,"stats");a&&u({total_patients:Number(a.total_patients||0),total_staff:Number(a.total_staff||0),appointments_today:Number(a.appointments_today||0),appointments_this_week:Number(a.appointments_this_week||0),revenue_this_month:Number(a.revenue_this_month||0),outstanding_balance:Number(a.outstanding_balance||0),recent_registrations:Number(a.recent_registrations||0)});const r=b(t,"recentAppointments");Array.isArray(r)&&A(r.slice(0,10));const l=b(t,"recentActivities");Array.isArray(l)&&$(l.slice(0,10))}catch(t){console.error("Error fetching dashboard data:",t),await P()}finally{k(!1)}},P=async()=>{var t;try{const[a,r,l]=await Promise.allSettled([f.getUsers({}),f.getAppointments({date:new Date().toISOString().split("T")[0],limit:10}),f.getFinancialRecords({limit:5})]);if(a.status==="fulfilled"){const s=a.value,n=Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.users)?s.users:Array.isArray(s)?s:[],d=n.filter(o=>o.role==="patient"),g=n.filter(o=>o.role==="staff");u(o=>({...o,total_patients:d.length,total_staff:g.length,recent_registrations:d.filter(N=>{const c=new Date(N.created_at),m=new Date;return m.setDate(m.getDate()-7),c>=m}).length}))}if(r.status==="fulfilled"){const s=r.value,n=Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.appointments)?s.appointments:Array.isArray(s)?s:[];A(n.slice(0,10));const d=new Date().toISOString().split("T")[0],g=new Date;g.setDate(g.getDate()-g.getDay());const o=n.filter(c=>{var m;return c.appointment_date===d||((m=c.appointment_date)==null?void 0:m.startsWith(d))}),N=n.filter(c=>new Date(c.appointment_date)>=g);u(c=>({...c,appointments_today:o.length,appointments_this_week:N.length}))}if(l.status==="fulfilled"){const s=l.value,n=(s==null?void 0:s.summary)||((t=s==null?void 0:s.data)==null?void 0:t.summary)||{};u(d=>({...d,revenue_this_month:Number(n.monthly_revenue||0),outstanding_balance:Number(n.outstanding_balance||0)}))}return{stats:i,recentAppointments:y,recentActivities:[]}}catch(a){return console.error("Fallback data fetch failed:",a),null}},F=async()=>{S(!0),await j(),S(!1)};p.useEffect(()=>{j();const t=setInterval(j,3e5);return()=>clearInterval(t)},[]);const C=t=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t),U=t=>t?new Date(t).toLocaleDateString("en-PH",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",M=t=>({scheduled:"bg-blue-100 text-blue-800",confirmed:"bg-green-100 text-green-800",checked_in:"bg-yellow-100 text-yellow-800",in_progress:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",no_show:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800",O=t=>{switch(t){case"create":return e.jsx(T,{className:"w-4 h-4"});case"update":return e.jsx(_,{className:"w-4 h-4"});case"delete":return e.jsx(Q,{className:"w-4 h-4"});default:return e.jsx(_,{className:"w-4 h-4"})}};return e.jsxs(B,{breadcrumbs:J,children:[e.jsx(W,{title:"Admin Dashboard"}),e.jsxs("div",{className:"flex flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Welcome to the Smart Medical Clinic administration panel"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:F,disabled:R,className:"flex items-center gap-2 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(v,{className:`w-4 h-4 ${R?"animate-spin":""}`}),"Refresh"]}),e.jsxs(x,{href:"/admin/reports",className:"flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[e.jsx(V,{className:"w-4 h-4"}),"Export Reports"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Patients"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h?"...":i.total_patients}),e.jsxs("p",{className:"text-xs text-green-600 flex items-center mt-1",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),i.recent_registrations," new this week"]})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(I,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Staff"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h?"...":i.total_staff}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Active personnel"})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(_,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Appointments Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h?"...":i.appointments_today}),e.jsxs("p",{className:"text-xs text-blue-600 flex items-center mt-1",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),i.appointments_this_week," this week"]})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx(L,{className:"w-6 h-6 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h?"...":C(i.revenue_this_month)}),e.jsxs("p",{className:"text-xs text-red-600 flex items-center mt-1",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),C(i.outstanding_balance)," outstanding"]})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(E,{className:"w-6 h-6 text-purple-600"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(x,{href:"/admin/patients",className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(T,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Patient"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Register new patient"})]})]}),e.jsxs(x,{href:"/admin/appointments",className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(q,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Book Appointment"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Schedule new appointment"})]})]}),e.jsxs(x,{href:"/admin/financial-records",className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(E,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Transaction"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Record payment"})]})]}),e.jsxs(x,{href:"/admin/users",className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(I,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Staff"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Register staff member"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Appointments"}),e.jsxs(x,{href:"/admin/appointments",className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-1",children:["View all",e.jsx(w,{className:"w-4 h-4"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:h?e.jsxs("div",{className:"p-6 text-center text-gray-500",children:[e.jsx(v,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),"Loading..."]}):y.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No recent appointments"}):y.map(t=>{var a,r,l,s;return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:((a=t.patient)==null?void 0:a.name)||"Unknown Patient"}),e.jsx("p",{className:"text-sm text-gray-600",children:((r=t.service)==null?void 0:r.name)||"Unknown Service"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Dr. ",((l=t.doctor)==null?void 0:l.name)||"Unknown Doctor"," â€¢ ",U(t.appointment_date)]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${M(t.status)}`,children:((s=t.status)==null?void 0:s.replace("_"," "))||"Unknown"})]})},t.id)})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activities"}),e.jsxs(x,{href:"/admin/reports/audit",className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-1",children:["View all",e.jsx(w,{className:"w-4 h-4"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:h?e.jsxs("div",{className:"p-6 text-center text-gray-500",children:[e.jsx(v,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),"Loading..."]}):D.length===0?e.jsxs("div",{className:"p-6 text-center text-gray-500",children:["No recent activities available",e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Activities will appear here when users perform actions"})]}):D.map(t=>{var a,r;return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2 bg-gray-100 rounded-full",children:O(t.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((a=t.performedBy)==null?void 0:a.name)||"System"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.action,"d ",((r=t.target_collection)==null?void 0:r.replace("_"," "))||"item"]}),e.jsx("p",{className:"text-xs text-gray-500",children:U(t.timestamp)})]})]})},t.id)})})]})]})]})]})}export{he as default};
