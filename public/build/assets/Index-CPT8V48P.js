import{r as i,j as e,L as ee,$ as te}from"./app-JcAsAuql.js";import{A as se,C as R,a as re}from"./app-layout-E1jTg9LY.js";import{a as p}from"./ApiAdmin-CigcBv4Z.js";import{R as M}from"./refresh-cw-BJG4YFjv.js";import{P as ae,S as le}from"./search-DCW9xceT.js";import{A as ne}from"./activity-BPAZzZpE.js";import{C as O}from"./circle-check-big-2mnnnVKB.js";import{C as q}from"./circle-x-CZFefVG-.js";import{U as oe}from"./user-Clo-9yXY.js";import{P as ie}from"./phone-BvaIeQQR.js";import{E as de}from"./eye-DbunR0GL.js";import{U as ce}from"./user-check-DK4LStuz.js";import{S as me}from"./square-pen-DJd9gEqa.js";import{T as xe}from"./trash-2-yi-JkhIH.js";import"./button-f96-MP48.js";import"./index-CfwClSTy.js";import"./index-jL6B-qfF.js";import"./index-BwiEApH7.js";import"./index-Bm2cAylQ.js";import"./app-logo-icon-DBA5PkxD.js";import"./sweetalert2.esm.all-acGi8jXx.js";const A={patient_id:"",doctor_id:"",service_id:"",appointment_date:"",appointment_time:"",reason_for_visit:"",notes:"",status:"scheduled"},D=[{value:"scheduled",label:"Scheduled",color:"bg-blue-100 text-blue-800"},{value:"confirmed",label:"Confirmed",color:"bg-green-100 text-green-800"},{value:"checked_in",label:"Checked In",color:"bg-yellow-100 text-yellow-800"},{value:"in_progress",label:"In Progress",color:"bg-purple-100 text-purple-800"},{value:"completed",label:"Completed",color:"bg-green-100 text-green-800"},{value:"cancelled",label:"Cancelled",color:"bg-red-100 text-red-800"},{value:"no_show",label:"No Show",color:"bg-gray-100 text-gray-800"}],pe=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Appointments",href:"/admin/appointments"}],$=(s,d=["appointments","users","services"])=>{var x,j;if(!s)return[];if(Array.isArray((x=s==null?void 0:s.data)==null?void 0:x.data))return s.data.data;if(Array.isArray(s==null?void 0:s.data))return s.data;for(const h of d){if(Array.isArray(s==null?void 0:s[h]))return s[h];if(Array.isArray((j=s==null?void 0:s.data)==null?void 0:j[h]))return s.data[h]}return[]},y=s=>Array.isArray(s)?s[0]:s,ue=(s,d)=>{const x=(d==null?void 0:d.length)>5?d.slice(0,5):d;return new Date(`${s} ${x}`).toLocaleString("en-PH",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})},W=s=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s),he=s=>{var d;return((d=D.find(x=>x.value===s))==null?void 0:d.color)||"bg-gray-100 text-gray-800"};function Le(){const[s,d]=i.useState([]),[x,j]=i.useState([]),[h,I]=i.useState([]),[T,U]=i.useState([]),[B,F]=i.useState(!0),[V,N]=i.useState(!1),[w,_]=i.useState(!1),[E,S]=i.useState(null),[l,c]=i.useState(A),[n,v]=i.useState({}),[g,L]=i.useState({date:new Date().toISOString().split("T")[0],status:"",doctor:"",patient:""}),[C,H]=i.useState({today:0,thisWeek:0,completed:0,cancelled:0}),f=async()=>{var t,r,m,o;try{F(!0),console.log("Fetching appointments with filters:",g);const a=await p.getAppointments(g);console.log("Raw API response:",a);let b=[],u={};a!=null&&a.data?(b=Array.isArray(a.data)?a.data:a.data.data||a.data.appointments||[],u=a.data.stats||a.stats||{}):(b=a.appointments||a||[],u=a.stats||{}),console.log("Processed appointments:",b),console.log("Processed stats:",u),d(b),u&&Object.keys(u).length>0&&H({today:Number(u.today||0),thisWeek:Number(u.thisWeek||0),completed:Number(u.completed||0),cancelled:Number(u.cancelled||0)})}catch(a){console.error("Error fetching appointments:",a),console.error("Error details:",{message:a.message,response:(t=a.response)==null?void 0:t.data,status:(r=a.response)==null?void 0:r.status}),d([]),((m=a.response)==null?void 0:m.status)===500?console.error("Server error - check Laravel logs"):((o=a.response)==null?void 0:o.status)===422?console.error("Validation error:",a.response.data):a.response||console.error("Network error - check connection")}finally{F(!1)}},P=async()=>{try{const[t,r,m]=await Promise.all([p.getUsers({role:"staff"}),p.getUsers({role:"patient"}),p.getServices({is_active:1})]),a=$(t,["users","data"]).filter(b=>b.position==="dentist"||b.role==="staff");j(a),I($(r,["users"])),U($(m,["services"]))}catch(t){console.error("Error fetching dropdown data:",t),j([]),I([]),U([])}};i.useEffect(()=>{P()},[]),i.useEffect(()=>{f()},[g]);const z=async t=>{var r,m;t.preventDefault(),v({});try{const o={...l,appointment_date:l.appointment_date,appointment_time:l.appointment_time};w&&E?(console.log("Updating appointment:",E.id,o),await p.updateAppointment(E.id,o)):(console.log("Creating appointment:",o),await p.createAppointment(o)),N(!1),c(A),S(null),_(!1),await f()}catch(o){console.error("Form submission error:",o),(m=(r=o==null?void 0:o.response)==null?void 0:r.data)!=null&&m.errors&&v(o.response.data.errors)}},X=async t=>{try{await p.deleteAppointment(t.id,`${t.patient.name}'s appointment`),await f()}catch(r){console.error("Error deleting appointment:",r)}},G=async t=>{console.log("Editing appointment:",t),S(t);let r=t.appointment_time;r&&r.includes(" ")&&(r=r.split(" ")[1]),r&&r.length>5&&(r=r.slice(0,5)),c({patient_id:t.patient.id.toString(),doctor_id:t.doctor.id.toString(),service_id:t.service.id.toString(),appointment_date:t.appointment_date.split("T")[0],appointment_time:r||"",reason_for_visit:t.reason_for_visit||"",notes:t.notes||"",status:t.status}),_(!0),v({}),await P(),N(!0)},J=async()=>{S(null),c(A),_(!1),v({}),await P(),N(!0)},k=(t,r)=>L(m=>({...m,[t]:r})),K=()=>L({date:new Date().toISOString().split("T")[0],status:"",doctor:"",patient:""}),Q=async t=>{try{await p.checkInAppointment(t.id),await f()}catch(r){console.error("Error checking in appointment:",r)}},Y=async t=>{try{await p.completeAppointment(t.id,"Appointment completed successfully"),await f()}catch(r){console.error("Error completing appointment:",r)}},Z=async t=>{try{await p.cancelAppointment(t.id,"Cancelled by admin"),await f()}catch(r){console.error("Error cancelling appointment:",r)}};return e.jsxs(se,{breadcrumbs:pe,children:[e.jsx(ee,{title:"Appointments Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointments Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage patient appointments and schedules"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),"Book Appointment"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today's Appointments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.today})]}),e.jsx(R,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Week"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.thisWeek})]}),e.jsx(ne,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:C.completed})]}),e.jsx(O,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:C.cancelled})]}),e.jsx(q,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search appointments...",value:g.patient,onChange:t=>k("patient",t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"date",value:g.date,onChange:t=>k("date",t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("select",{value:g.status,onChange:t=>k("status",t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Status"}),D.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsxs("select",{value:g.doctor,onChange:t=>k("doctor",t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Doctors"}),x.map(t=>e.jsxs("option",{value:t.id.toString(),children:["Dr. ",t.name]},t.id))]}),e.jsx("button",{onClick:K,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Clear"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor & Service"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(M,{className:"w-6 h-6 animate-spin mr-2"}),"Loading appointments..."]})})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(R,{className:"w-12 h-12 text-gray-300 mb-2"}),e.jsx("p",{children:"No appointments found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your filters or create a new appointment"})]})})}):s.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(oe,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.patient.name}),t.patient.phone&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),t.patient.phone]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Dr. ",t.doctor.name]}),e.jsx("div",{className:"text-sm text-gray-500",children:t.service.name}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center mt-1",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),t.service.duration_minutes," min • ",W(t.service.price)]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:ue(t.appointment_date,t.appointment_time)}),t.reason_for_visit&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.reason_for_visit})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${he(t.status)}`,children:((r=D.find(m=>m.value===t.status))==null?void 0:r.label)||t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{href:`/appointments/${t.id}`,className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"View Details",children:e.jsx(de,{className:"w-4 h-4"})}),t.status==="confirmed"&&e.jsx("button",{onClick:()=>Q(t),className:"p-1 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Check In",children:e.jsx(ce,{className:"w-4 h-4"})}),t.status==="in_progress"&&e.jsx("button",{onClick:()=>Y(t),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Complete",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(t),className:"p-1 text-purple-600 hover:bg-purple-50 rounded transition-colors",title:"Edit",children:e.jsx(me,{className:"w-4 h-4"})}),["scheduled","confirmed"].includes(t.status)&&e.jsx("button",{onClick:()=>Z(t),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancel",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(t),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})})]},t.id)})})]})})})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:w?"Edit Appointment":"Book New Appointment"}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Patient *"}),e.jsxs("select",{value:l.patient_id,onChange:t=>c({...l,patient_id:t.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.patient_id?"border-red-500":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:"Select patient"}),h.length===0?e.jsx("option",{value:"",disabled:!0,children:"(No patients available)"}):h.map(t=>e.jsx("option",{value:t.id.toString(),children:t.name},t.id))]}),n.patient_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.patient_id)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doctor *"}),e.jsxs("select",{value:l.doctor_id,onChange:t=>c({...l,doctor_id:t.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.doctor_id?"border-red-500":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:"Select doctor"}),x.length===0?e.jsx("option",{value:"",disabled:!0,children:"(No doctors available)"}):x.map(t=>e.jsxs("option",{value:t.id.toString(),children:["Dr. ",t.name]},t.id))]}),n.doctor_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.doctor_id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Service *"}),e.jsxs("select",{value:l.service_id,onChange:t=>c({...l,service_id:t.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.service_id?"border-red-500":"border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"",children:"Select service"}),T.length===0?e.jsx("option",{value:"",disabled:!0,children:"(No services available)"}):T.map(t=>e.jsxs("option",{value:t.id.toString(),children:[t.name," - ",t.duration_minutes," min (",W(t.price),")"]},t.id))]}),n.service_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.service_id)})]}),w&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsx("select",{value:l.status||"scheduled",onChange:t=>c({...l,status:t.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.status?"border-red-500":"border-gray-300"}`,children:D.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),n.status&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Appointment Date *"}),e.jsx("input",{type:"date",value:l.appointment_date,onChange:t=>c({...l,appointment_date:t.target.value}),min:new Date().toISOString().split("T")[0],className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.appointment_date?"border-red-500":"border-gray-300"}`,required:!0}),n.appointment_date&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.appointment_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Appointment Time *"}),e.jsx("input",{type:"time",value:l.appointment_time,onChange:t=>c({...l,appointment_time:t.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.appointment_time?"border-red-500":"border-gray-300"}`,required:!0}),n.appointment_time&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y(n.appointment_time)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Visit"}),e.jsx("input",{type:"text",value:l.reason_for_visit,onChange:t=>c({...l,reason_for_visit:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter reason for visit (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:t=>c({...l,notes:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Enter additional notes (optional)"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),c(A),v({}),S(null),_(!1)},className:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[w?"Update":"Book"," Appointment"]})]})]})]})})})]})}export{Le as default};
